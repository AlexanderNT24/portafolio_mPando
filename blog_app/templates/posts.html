{% extends 'layout.html' %}
{% block content %}
<div class="container text-center">
    <div class="row row-cols-2" id="post-container">
    {% for post in posts|slice:":9" %} {# Limita a cargar solo las primeras 9 imágenes #}
    <div data-aos="fade-down" data-aos-easing="linear" data-aos-duration="700" class="col">
        <a href="{% url 'blog:post_detail' post.id %}">
            <img data-src="{{ post.image.url }}" class="img-fluid lazy" alt="{{ post.title }}">
        </a>
        <p class="description-post-tag">{{ post.title }}.{{ post.description|striptags|truncatechars:10 }}</p>
        <p class="description-post-tag">
            {% if post.start_date %}
            <span id="start-date-{{ post.id }}">{{ post.start_date|date:'m.d.y' }}</span>
            <script>
                // Código JavaScript para actualizar la fecha en tiempo real
                setInterval(function() {
                    var startDateElement = document.getElementById('start-date-{{ post.id }}');
                    var startDate = new Date('{{ post.start_date }}');
                    startDateElement.innerText = startDate.toLocaleDateString();
                }, 1000);
            </script>
            {% endif %}
            {% if post.end_date %}
            -<span id="end-date-{{ post.id }}">{{ post.end_date|date:'m.d.y' }}</span>
            <script>
                // Código JavaScript para actualizar la fecha en tiempo real
                setInterval(function() {
                    var endDateElement = document.getElementById('end-date-{{ post.id }}');
                    var endDate = new Date('{{ post.end_date }}');
                    endDateElement.innerText = endDate.toLocaleDateString();
                }, 1000);
            </script>
            {% endif %}
        </p>
    </div>
    {% endfor %}
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var lazyImages = document.querySelectorAll('.lazy');
    var options = {
        rootMargin: '0px',
        threshold: 0.1
    };
    var imageObserver = new IntersectionObserver(function(entries, observer) {
        entries.forEach(function(entry) {
            if (entry.isIntersecting) {
                var image = entry.target;
                image.src = image.dataset.src;
                image.classList.remove('lazy');
                imageObserver.unobserve(image);
            }
        });
    }, options);

    lazyImages.forEach(function(image) {
        imageObserver.observe(image);
    });
});
</script>

{% endblock %}
